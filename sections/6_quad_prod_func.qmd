### Fonction de production quadratique

:::{.callout-tip}

## Forme de la fonction

$$
q_i = \alpha + \sum_{k=1}^3\beta_k x_{ik} + \frac{1}{2}\sum_{l=1}^3\sum_{k=1}^3 \beta_{kl}x_{ik}x_{il} + Îµ_i
$$

- La **fonction de production quadratique** dans notre cas s'Ã©crit donc sous la forme :

$$
\begin{gathered}q_{Out}â€‹=Î±+Î²_1â€‹q_{Cap}â€‹+Î²_2â€‹q_{Lab}â€‹+Î²_3â€‹q_{Mat}\\
â€‹+\frac{1}{2}â€‹(Î²_{11}â€‹q^2_{Cap}â€‹+Î²_{22}â€‹q^2_{Lab}â€‹+Î²_{33}â€‹q^2_{Mat})\\
â€‹+â€‹Î²_{12}â€‹q_{Cap}â€‹q_{Lab}â€‹+Î²_{13}â€‹q_{Cap}â€‹q_{Mat}â€‹+Î²_{23}â€‹q_{Lab}â€‹q_{Mat}â€‹+Îµ_iâ€‹
\end{gathered}
$$

:::

**âœ… Avantages :** 

- La fonction de production quadratique va permettre d'ajouter des termes *quadratiques* et des effets d'*interaction*, rendant la modÃ©lisation plus robuste.

**âŒ InconvÃ©nients :** 

- L'ajout de termes supplÃ©mentaires implique plus de complexitÃ© et de coefficients Ã  estimer $(3^2 = 9)$.

```{r}
#| label: quad_prod
#| code-fold: false
quad_prod <- quadFuncEst(
    "qOut",
    c("qCap", "qLab", "qMat"),
    data = apples
)
```

```{r}
#| label: quad_prod_table
#| echo: false
gtgazer(
    quad_prod,
    n_coef = 9,
    coefnames = c("$\\alpha$", "$\\beta_1$", "$\\beta_2$", "$\\beta_3$", "$\\beta_{11}$", "$\\beta_{12}$", "$\\beta_{13}$", "$\\beta_{22}$", "$\\beta_{23}$", "$\\beta_{33}$"),
    description = c(
        "- Constante du modÃ¨le",
        "- Coefficient associÃ© Ã  la variable `qCap`",
        "- Coefficient associÃ© Ã  la variable `qLab`",
        "- Coefficient associÃ© Ã  la variable `qMat`",
        "- Coefficient associÃ© Ã  la variable `qCapÂ²`",
        "- Coefficient associÃ© Ã  la variable `qCapÃ—qLab`",
        "- Coefficient associÃ© Ã  la variable `qCapÃ—qMat`",
        "- Coefficient associÃ© Ã  la variable `qLabÂ²`",
        "- Coefficient associÃ© Ã  la variable `qLabÃ—qMat`",
        "- Coefficient associÃ© Ã  la variable `qMatÂ²`"
    ),
    title = "**Fonction de production quadratique**",
    subtitle = "Variable dÃ©pendante : `qOut`",
    bg_color = bg_color
) |> fmt_number(
    columns = coefficients,
    rows = c(5:9),
    decimals = 5,
    drop_trailing_zeros = TRUE
)
```

```{r}
#| label: quad_prod_metrics
#| echo: false
apples <- apples |> mutate(
    qCap2 = 0.5 * qCap^2,
    qLab2 = 0.5 * qLab^2,
    qMat2 = 0.5 * qMat^2
)

quad_prod_2 <- lm(
    qOut ~ qCap + qLab + qMat +
        qCap2 + qLab2 + qMat2 +
        I(qCap * qLab) + I(qLab * qMat) + I(qMat * qCap),
    data = apples
)

aic_quad_prod <- AIC(quad_prod_2)
bic_quad_prod <- BIC(quad_prod_2)
loglik_quad_prod <- logLik(quad_prod_2)[1]
```

- Le coefficient associÃ© Ã  `qCap` est de 5.27, mais il n'est pas statistiquement significatif, ce qui suggÃ¨re que la quantitÃ© de capital n'a pas une influence significative sur la production totale dans ce modÃ¨le.

- Le coefficient associÃ© Ã  `qLab` est de 6.077 avec un niveau de significativitÃ© assez faible, ce qui signifie que pour chaque unitÃ© supplÃ©mentaire de travail utilisÃ©e, la production totale augmente en moyenne de 6.077 unitÃ©s, *toutes choses Ã©gales par ailleurs*.

- Le coefficient associÃ© Ã  `qMat` est de 14.303, mais il n'est pas statistiquement significatif, ce qui suggÃ¨re que la quantitÃ© de matÃ©riaux n'a pas une influence significative sur la production totale dans ce modÃ¨le.

- Le coefficient associÃ© Ã  l'effet d'interaction entre les quantitÃ©s de capital et de travail (`qCapÃ—qLab`) est nÃ©gatif et significatif au seuil de 5%. Cela suggÃ¨re que l'interaction entre ces 2 facteurs a un effet nÃ©gatif sur la production.

- Le coefficient associÃ© Ã  l'effet d'interaction entre les quantitÃ©s de tavail et de matÃ©riaux (`qLabÃ—qMat`) est positif et significatif au seuil de 1%. Cela suggÃ¨re que l'interaction entre ces 2 facteurs a un effet positif sur la production.

- Enfin, le coefficient associÃ© Ã  l'effet quadratique des matÃ©riaux (`qMatÂ²`) est statistiquement significatif au seuil 5% et possÃ¨de une valeur nÃ©gative, ce qui suggÃ¨re une courbe de rendement d'Ã©chelle dÃ©croissante pour les matÃ©riaux, indiquant que l'augmentation de la quantitÃ© de matÃ©riaux pourrait initialement augmenter la production, mais Ã  un rythme dÃ©croissant.

$R^2_{adj} =$ 0.834 donc 83.4% de la variance de la production totale est expliquÃ©e par la variance des variables explicatives. Ce rÃ©sultat est meilleur que la fonction de production linÃ©aire.

```{r}
#| label: heterosced_investigate_quad
#| echo: false
predicted_qOut <- predict(quad_prod) |>
    as_tibble() |>
    rename(predicted_qOut = value)
qOut <- apples |> select(qOut)

residuals <- resid(quad_prod) |>
    as_tibble() |>
    rename(residuals = value)

bind_cols(qOut, predicted_qOut, residuals) |>
    mutate(diff = predicted_qOut / qOut) |>
    arrange(diff) |>
    gt() |>
    tab_header(title = md("ğŸ” Comparaison de la **production effective** et de la **production prÃ©dite**")) |>
    cols_label(
        qOut = md("$q_{Out}$"),
        predicted_qOut = md("$\\widehat{q_{Out}}$"),
        residuals = md("$\\varepsilon_i$"),
        diff = md("$\\widehat{q_{Out}}/q_{Out}$")
    ) |>
    fmt_number(suffixing = TRUE, n_sigfi = 2) |>
    cols_align("center") |>
    tab_options(
        table.background.color = bg_color
    ) |>
    opt_interactive(use_highlight = TRUE)
```

```{r}
#| label: vif_quad
#| warning: false
#| echo: false
#| fig-align: center
collinearity_quad <- check_collinearity(quad_prod_2, verbose = FALSE) |>
    as_tibble() |>
    mutate(
        Term = case_when(
            Term == "qCap2" ~ "qCapÂ²",
            Term == "qLab2" ~ "qLabÂ²",
            Term == "qMat2" ~ "qMatÂ²",
            Term == "I(qCap * qLab)" ~ "qCapÃ—qLab",
            Term == "I(qLab * qMat)" ~ "qLabÃ—qMat",
            Term == "I(qMat * qCap)" ~ "qMatÃ—qCap",
            .default = as.character(Term)
        )
    )

ggplot(collinearity_quad, aes(x = Term, y = VIF)) +
    geom_point(size = 3.5, color = "darkred") +
    geom_pointrange(aes(ymin = VIF_CI_low, ymax = VIF_CI_high), color = "darkred") +
    geom_rect(aes(xmin = 0, xmax = 10, ymin = 10, ymax = Inf), fill = "red", alpha = 0.01) +
    geom_rect(aes(xmin = 0, xmax = 10, ymin = 5, ymax = 10), fill = "blue", alpha = 0.01) +
    geom_rect(aes(xmin = 0, xmax = 10, ymin = 0, ymax = 5), fill = "green", alpha = 0.01) +
    labs(
        title = "Etude des VIF",
        subtitle = "Pour la fonction de production quadratique",
        x = "",
        y = ""
    )
```

Les valeurs de **VIF** sont ici **extrÃªmement Ã©levÃ©es**. La forme fonctionnelle du modÃ¨le avec interactions et effets quadratiques entraÃ®ne naturellement ces forts problÃ¨mes de multicolinÃ©aritÃ©.

```{r}
#| label: posterior_quad
#| fig-align: center
#| echo: false
posterior_predictive_check(quad_prod_2)
```

On semble Ãªtre dans une situation de **surapprentissage**, en effet le modÃ¨le s'ajuste trop par rapport aux donnÃ©es sur lesquelles il a Ã©tÃ© entrainÃ©, il gÃ©nÃ©ralise donc mal et est trÃ¨s sensible au bruit.

#### ProductivitÃ© marginale des inputs

```{r}
#| label: quad_prod_mp
#| code-fold: false
quad_prod_margProducts <- quadFuncDeriv(
    c("qCap", "qLab", "qMat"),
    data = apples,
    coef = coef(quad_prod),
    coefCov = vcov(quad_prod)
)
```

```{r}
#| label: quad_prod_mp_table
#| echo: false
quad_prod_margProducts |>
    as_tibble() |>
    rowid_to_column() |>
    gt() |>
    cols_label(
        rowid = md("$N$"),
        qCap = md("$MP_{Cap}$"),
        qLab = md("$MP_{Lab}$"),
        qMat = md("$MP_{Mat}$")
    ) |>
    fmt_number(-rowid) |>
    fmt_integer(rowid, pattern = "Producteur {x}") |>
    cols_align("center") |>
    tab_header(
        title = md("**ProductivitÃ©s marginales**"),
        subtitle = md("*Dans le cadre d'une fonction de production `quadratique`*")
    ) |>
    tab_options(
        table.background.color = bg_color
    ) |>
    opt_interactive(use_highlight = TRUE)
```

> Cette fois on remarque qu'il existe des **productivitÃ©s marginales nÃ©gatives**. Prenons l'exemple du producteur 1. Si celui-ci dÃ©cide d'ajouter une unitÃ© de capital en maintenant les autres inputs constants (travail et matÃ©riaux), alors sa production va diminuer de 3.07 unitÃ©s.
